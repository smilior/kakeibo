# 夫婦向け浪費管理アプリ 要件定義書

**バージョン:** 1.0
**作成日:** 2026年1月18日
**ステークホルダー:** ご夫婦（2名）

---

## 1. プロジェクト概要

### 1.1 背景
- 電子マネー（PayPay、Suica、QUICPay）を意識せずに使ってしまう
- サブスクリプションの支出が月約25,000円ある
- 外食や遠出の頻度が把握できていない
- Moneyforwardで記録はしているが「誰が・何に・いくら使ったか」が見えにくい

### 1.2 目的
- 支出の「見える化」を実現する
- 使いすぎを防止する
- 夫婦間でルールを決めて運用する

### 1.3 解決アプローチ
- Moneyforwardは自動記録用として継続利用
- 新アプリで「誰が・何のカテゴリに・何回使ったか」を手入力で管理
- 回数ベースのルール管理で浪費を抑制

---

## 2. ユーザー要件

### 2.1 ユーザー
| ユーザー | 役割 |
|---------|------|
| 夫 | 支出入力、閲覧 |
| 妻 | 支出入力、閲覧 |

### 2.2 利用環境
- **デバイス:** スマートフォン（Webブラウザ）
- **プラットフォーム:** Webアプリ（レスポンシブ対応）

### 2.3 認証方式
- Googleアカウント認証（Supabase Auth）
- 夫婦で別アカウント、同一家計データを共有

---

## 3. 機能要件

### 3.1 機能一覧

| # | 機能名 | 優先度 | 説明 |
|---|--------|--------|------|
| F01 | 支出入力 | Must | 手入力で支出を記録 |
| F02 | カテゴリ管理 | Must | 大分類カテゴリの追加・編集・削除 |
| F03 | 回数ルール管理 | Must | カテゴリごとの月間回数上限設定 |
| F04 | 残り回数表示 | Must | カテゴリごとの今月の残り回数表示 |
| F05 | LINE通知 | Must | 支出登録時にLINE Notifyで通知 |
| F06 | ダッシュボード | Must | 今月の残り予算・回数を一覧表示 |
| F07 | カテゴリ別円グラフ | Must | 支出のカテゴリ別割合を可視化 |
| F08 | 夫婦別支出比較 | Must | 夫婦それぞれの支出額を比較表示 |
| F09 | サブスク管理 | Must | サブスク一覧・合計金額・更新日表示 |
| F10 | 過去比較 | Should | 先月比・過去月との比較 |
| F11 | 高額相談機能 | Want | 一定額以上の支出時に相談リマインド |

### 3.2 機能詳細

#### F01: 支出入力
```
入力項目:
- 日付（デフォルト: 今日）
- 金額
- カテゴリ（プルダウン選択）
- メモ（任意）
- 入力者（自動: ログインユーザー）
```

#### F02: カテゴリ管理
```
デフォルトカテゴリ:
- 食費
- 外食
- 日用品
- 交通費
- 娯楽
- サブスク
- 衣服
- 医療
- その他

機能:
- カテゴリの追加
- カテゴリ名の編集
- カテゴリの削除（紐づく支出がある場合は警告）
```

#### F03: 回数ルール管理
```
設定項目:
- 対象カテゴリ
- 月間上限回数
- 有効/無効フラグ

例:
- 外食: 月4回まで
- 娯楽: 月3回まで
- 遠出: 月2回まで

カウント方法: 夫婦合算
```

#### F05: LINE通知
```
通知タイミング: 支出登録時（毎回）

通知内容:
- 登録者名
- カテゴリ
- 金額
- 今月の残り回数（ルール設定がある場合）

例:
「【支出登録】
👤 夫
📁 外食
💰 3,500円
📝 ランチ
⚠️ 外食 残り2回」
```

#### F09: サブスク管理
```
入力項目:
- サービス名
- 月額料金
- 契約日
- 更新日（任意）
- メモ（任意）

表示:
- サブスク一覧
- 合計金額
- 次回更新日
```

---

## 4. 画面設計

### 4.1 画面一覧

| # | 画面名 | 説明 |
|---|--------|------|
| S01 | ログイン画面 | Googleアカウントでログイン |
| S02 | ダッシュボード | メイン画面、残り回数・予算サマリー |
| S03 | 支出入力画面 | 支出の新規登録 |
| S04 | 支出履歴画面 | 過去の支出一覧 |
| S05 | カテゴリ管理画面 | カテゴリの追加・編集・削除 |
| S06 | ルール設定画面 | 回数ルールの設定 |
| S07 | グラフ画面 | 円グラフ・比較グラフ |
| S08 | サブスク管理画面 | サブスク一覧・登録 |
| S09 | 設定画面 | LINE連携・アカウント設定 |

### 4.2 画面遷移図

```
[ログイン]
    │
    ▼
[ダッシュボード] ─┬─→ [支出入力]
    │            ├─→ [支出履歴]
    │            ├─→ [グラフ]
    │            ├─→ [サブスク管理]
    │            └─→ [設定]
    │                   ├─→ [カテゴリ管理]
    │                   ├─→ [ルール設定]
    │                   └─→ [LINE連携]
```

### 4.3 ダッシュボード構成

```
┌─────────────────────────────────────┐
│  今月のサマリー                      │
│  ─────────────────────────────────  │
│  総支出: ¥45,000                    │
│                                     │
│  【回数制限カテゴリ】                │
│  外食    ████░░░░  3/4回            │
│  娯楽    ██░░░░░░  1/3回            │
│  遠出    ░░░░░░░░  0/2回            │
│                                     │
│  【今月の内訳】                      │
│  [円グラフ]                         │
│                                     │
│  【夫婦別支出】                      │
│  夫: ¥25,000  妻: ¥20,000           │
└─────────────────────────────────────┘
```

---

## 5. データ設計

### 5.1 エンティティ一覧

```
users（ユーザー）
├── id: UUID (PK)
├── email: string
├── name: string
├── household_id: UUID (FK)
└── created_at: timestamp

households（家計）
├── id: UUID (PK)
├── name: string
├── line_notify_token: string (encrypted)
└── created_at: timestamp

categories（カテゴリ）
├── id: UUID (PK)
├── household_id: UUID (FK)
├── name: string
├── sort_order: integer
└── is_active: boolean

expenses（支出）
├── id: UUID (PK)
├── household_id: UUID (FK)
├── user_id: UUID (FK)
├── category_id: UUID (FK)
├── amount: integer
├── date: date
├── memo: string
└── created_at: timestamp

rules（ルール）
├── id: UUID (PK)
├── household_id: UUID (FK)
├── category_id: UUID (FK)
├── monthly_limit_count: integer
└── is_active: boolean

subscriptions（サブスク）
├── id: UUID (PK)
├── household_id: UUID (FK)
├── name: string
├── monthly_amount: integer
├── contract_date: date
├── renewal_date: date
├── memo: string
└── is_active: boolean
```

### 5.2 ER図

```
┌─────────────┐       ┌─────────────┐
│  households │───┬───│    users    │
└─────────────┘   │   └─────────────┘
       │          │          │
       │          │          │
       ▼          │          │
┌─────────────┐   │          │
│ categories  │   │          │
└─────────────┘   │          │
       │          │          │
       ├──────────┼──────────┘
       │          │
       ▼          ▼
┌─────────────┐  ┌─────────────┐
│   rules     │  │  expenses   │
└─────────────┘  └─────────────┘

┌─────────────┐
│subscriptions│──→ households
└─────────────┘
```

---

## 6. 技術要件

### 6.1 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | Next.js (React) + TypeScript |
| UIライブラリ | Tailwind CSS + shadcn/ui |
| バックエンド | Supabase (PostgreSQL + Auth + Edge Functions) |
| 認証 | Supabase Auth (Google OAuth) |
| 通知 | LINE Notify API |
| ホスティング | Vercel |
| グラフ | Recharts |

### 6.2 選定理由

- **Supabase:** 認証・DB・APIを一元管理、無料枠で十分
- **Next.js:** SSR対応、Vercelとの親和性
- **LINE Notify:** 無料、実装が容易、スマホ通知に最適

---

## 7. 非機能要件

### 7.1 性能要件
- 画面表示: 3秒以内
- 支出登録: 2秒以内

### 7.2 可用性
- 稼働率: 99%（Vercel + Supabase標準）

### 7.3 セキュリティ
- 全通信HTTPS化
- Supabase RLS（Row Level Security）による家計単位のデータ分離
- LINE Notifyトークンの暗号化保存

### 7.4 拡張性
- カテゴリは無制限に追加可能
- 将来的な金額ルール追加を考慮した設計

---

## 8. 制約条件

### 8.1 前提条件
- 夫婦ともにGoogleアカウントを所有
- LINEアプリをインストール済み
- Moneyforwardは引き続き利用（自動記録用）

### 8.2 スコープ外
- 銀行・クレジットカード自動連携
- レシート読み取り（OCR）
- 複数家計の管理
- ネイティブアプリ（iOS/Android）

---

## 9. 用語定義

| 用語 | 定義 |
|------|------|
| 家計（household） | 夫婦で共有する家計管理の単位 |
| 回数ルール | カテゴリごとの月間利用回数の上限 |
| サブスク | 毎月定額で発生する固定費 |

---

## 10. 今後の拡張候補（将来バージョン）

- 金額ベースの予算管理
- 高額支出時の承認フロー
- サブスク更新日のリマインド通知
- レシート撮影による自動入力
- 年間レポート機能

---

**以上**
