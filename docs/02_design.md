# å¤«å©¦å‘ã‘æµªè²»ç®¡ç†ã‚¢ãƒ—ãƒª è©³ç´°è¨­è¨ˆæ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0
**ä½œæˆæ—¥:** 2026å¹´1æœˆ18æ—¥
**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯:** Next.js / Vercel / Supabase / shadcn/ui

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
3. [èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è¨­è¨ˆ](#3-èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è¨­è¨ˆ)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [APIè¨­è¨ˆ](#5-apiè¨­è¨ˆ)
6. [ç”»é¢è¨­è¨ˆ](#6-ç”»é¢è¨­è¨ˆ)
7. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](#7-ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ)
8. [çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ](#8-çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ)
9. [å¤–éƒ¨é€£æºè¨­è¨ˆ](#9-å¤–éƒ¨é€£æºè¨­è¨ˆ)
10. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#10-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
11. [é–‹ç™ºç’°å¢ƒãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ](#11-é–‹ç™ºç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ)
12. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ](#12-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Next.js (App Router) + PWA                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚ shadcn  â”‚ â”‚Recharts â”‚ â”‚ Tanstackâ”‚ â”‚  Zustand â”‚       â”‚   â”‚
â”‚  â”‚  â”‚   /ui   â”‚ â”‚         â”‚ â”‚  Query  â”‚ â”‚          â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Vercel                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Edge Runtime                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚   API Routes â”‚  â”‚  Middleware  â”‚  â”‚   SSR/RSC   â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Supabase                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Auth     â”‚  â”‚   Storage   â”‚             â”‚
â”‚  â”‚     + RLS    â”‚  â”‚   (OAuth)   â”‚  â”‚  (optional) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚    Realtime  â”‚  â”‚Edge Functionsâ”‚                              â”‚
â”‚  â”‚  (optional)  â”‚  â”‚ (LINEé€šçŸ¥)   â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ LINE Notify  â”‚                                                â”‚
â”‚  â”‚     API      â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | é¸å®šç†ç”± |
|---------|------|-----------|---------|
| **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** | Next.js | 16.x | App Routerã€RSCå¯¾å¿œã€Vercelæœ€é©åŒ– |
| **è¨€èª** | TypeScript | 5.x | å‹å®‰å…¨æ€§ã€é–‹ç™ºåŠ¹ç‡å‘ä¸Š |
| **UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª** | shadcn/ui | latest | ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ã€ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ |
| **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°** | Tailwind CSS | 4.x | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã€shadcn/uiå‰æ |
| **çŠ¶æ…‹ç®¡ç†** | Zustand | 5.x | è»½é‡ã€ã‚·ãƒ³ãƒ—ãƒ«ã€TypeScriptè¦ªå’Œæ€§ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ** | TanStack Query | 5.x | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€æ¥½è¦³çš„æ›´æ–°ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |
| **ãƒ•ã‚©ãƒ¼ãƒ ** | React Hook Form + Zod | latest | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ |
| **ã‚°ãƒ©ãƒ•** | Recharts | 3.x | Reactç‰¹åŒ–ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ |
| **æ—¥ä»˜æ“ä½œ** | date-fns | 4.x | è»½é‡ã€Tree-shakingå¯¾å¿œ |
| **BaaS** | Supabase | latest | èªè¨¼ãƒ»DBä¸€å…ƒç®¡ç†ã€ç„¡æ–™æ ååˆ† |
| **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°** | Vercel | - | Next.jsæœ€é©åŒ–ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ |
| **PWA** | Serwist | latest | ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ |

### 1.3 ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆClaudeãƒ†ãƒ¼ãƒãƒ»æš–è‰²ç³»ï¼‰

```css
/* ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ï¼ˆClaudeã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼‰ */
--primary-50: #FFF7ED;
--primary-100: #FFEDD5;
--primary-200: #FED7AA;
--primary-300: #FDBA74;
--primary-400: #FB923C;
--primary-500: #F97316;  /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ */
--primary-600: #EA580C;
--primary-700: #C2410C;

/* ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚«ãƒ©ãƒ¼ï¼ˆæš–ã‹ã„ãƒ™ãƒ¼ã‚¸ãƒ¥ç³»ï¼‰ */
--secondary-50: #FAFAF9;
--secondary-100: #F5F5F4;
--secondary-200: #E7E5E4;
--secondary-300: #D6D3D1;

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
--accent-success: #22C55E;  /* ç·‘ï¼šäºˆç®—å†… */
--accent-warning: #EAB308;  /* é»„ï¼šæ³¨æ„ */
--accent-danger: #EF4444;   /* èµ¤ï¼šè¶…é */

/* èƒŒæ™¯ */
--background: #FFFBF7;      /* æš–ã‹ã„ã‚ªãƒ•ãƒ›ãƒ¯ã‚¤ãƒˆ */
--foreground: #1C1917;      /* ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ©ã‚¦ãƒ³ */
```

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 Next.js App Routeræ§‹æˆ

```
app/
â”œâ”€â”€ (auth)/                    # èªè¨¼ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…±æœ‰ï¼‰
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ invite/
â”‚       â””â”€â”€ [token]/
â”‚           â””â”€â”€ page.tsx
â”œâ”€â”€ (dashboard)/               # èªè¨¼å¾Œã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”œâ”€â”€ layout.tsx            # ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ page.tsx              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
â”‚   â”œâ”€â”€ expenses/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # æ”¯å‡ºä¸€è¦§
â”‚   â”‚   â””â”€â”€ new/
â”‚   â”‚       â””â”€â”€ page.tsx      # æ”¯å‡ºå…¥åŠ›
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ page.tsx          # ã‚°ãƒ©ãƒ•ãƒ»åˆ†æ
â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â””â”€â”€ page.tsx          # ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†
â”‚   â””â”€â”€ settings/
â”‚       â”œâ”€â”€ page.tsx          # è¨­å®šãƒˆãƒƒãƒ—
â”‚       â”œâ”€â”€ categories/
â”‚       â”‚   â””â”€â”€ page.tsx      # ã‚«ãƒ†ã‚´ãƒªç®¡ç†
â”‚       â”œâ”€â”€ rules/
â”‚       â”‚   â””â”€â”€ page.tsx      # ãƒ«ãƒ¼ãƒ«è¨­å®š
â”‚       â”œâ”€â”€ household/
â”‚       â”‚   â””â”€â”€ page.tsx      # å®¶è¨ˆè¨­å®šãƒ»æ‹›å¾…
â”‚       â””â”€â”€ line/
â”‚           â””â”€â”€ page.tsx      # LINEé€£æº
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚       â””â”€â”€ route.ts      # OAuth callback
â”‚   â””â”€â”€ line/
â”‚       â””â”€â”€ notify/
â”‚           â””â”€â”€ route.ts      # LINEé€šçŸ¥é€ä¿¡
â”œâ”€â”€ layout.tsx                 # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ manifest.ts                # PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â””â”€â”€ globals.css
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Client Component                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     UI Layer                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚  â”‚  Form   â”‚  â”‚  List   â”‚  â”‚  Chart  â”‚            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚            â”‚            â”‚                        â”‚
â”‚          â–¼            â–¼            â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              TanStack Query Layer                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚  useMutation â”‚  â”‚   useQuery  â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚  (create/   â”‚  â”‚   (read)    â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚   update/   â”‚  â”‚             â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚   delete)   â”‚  â”‚             â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                â”‚                              â”‚
â”‚            â”‚  Optimistic    â”‚  Cache                       â”‚
â”‚            â”‚  Update        â”‚  Invalidation                â”‚
â”‚            â–¼                â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Supabase Client                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚            @supabase/ssr                     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS (RLSé©ç”¨)
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Supabase     â”‚
                    â”‚   PostgreSQL    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è¨­è¨ˆ

### 3.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ–°è¦ç™»éŒ²ãƒ•ãƒ­ãƒ¼                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼]
       â”‚
       â”‚ 1. ã‚¢ã‚¯ã‚»ã‚¹
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Googleã§ãƒ­ã‚°ã‚¤ãƒ³
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Auth â”‚â”€â”€â”€â–¶â”‚ Google OAuth â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/auth/   â”‚
â”‚   callback   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. usersãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
       â–¼
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚ æ—¢å­˜ï¼Ÿ   â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
   â–¼       â–¼
[æ—¢å­˜]   [æ–°è¦]
   â”‚       â”‚
   â”‚       â”‚ 5. householdæœªæ‰€å±
   â”‚       â–¼
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  â”‚ å®¶è¨ˆä½œæˆ or   â”‚
   â”‚  â”‚ æ‹›å¾…ãƒªãƒ³ã‚¯å…¥åŠ› â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚         â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚    â”‚         â”‚
   â”‚    â–¼         â–¼
   â”‚  [ä½œæˆ]    [å‚åŠ ]
   â”‚    â”‚         â”‚
   â”‚    â”‚ 6a.     â”‚ 6b.
   â”‚    â–¼         â–¼
   â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  â”‚æ–°è¦ â”‚  â”‚æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³â”‚
   â”‚  â”‚å®¶è¨ˆ â”‚  â”‚  æ¤œè¨¼     â”‚
   â”‚  â”‚ä½œæˆ â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚  â””â”€â”€â”¬â”€â”€â”˜       â”‚
   â”‚     â”‚          â”‚
   â”‚     â”‚ 7.       â”‚
   â”‚     â–¼          â–¼
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  â”‚ household_idã‚’  â”‚
   â”‚  â”‚  usersã«è¨­å®š    â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ 8. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ‹›å¾…ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ‹›å¾…ãƒ•ãƒ­ãƒ¼                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[å®¶è¨ˆä½œæˆè€…]                              [æ‹›å¾…ã•ã‚Œã‚‹äºº]
     â”‚                                         â”‚
     â”‚ 1. æ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆ                        â”‚
     â–¼                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚è¨­å®š > å®¶è¨ˆè¨­å®šâ”‚                              â”‚
â”‚ > æ‹›å¾…ãƒªãƒ³ã‚¯  â”‚                              â”‚
â”‚   ç”Ÿæˆãƒœã‚¿ãƒ³  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
       â”‚                                        â”‚
       â”‚ 2. invitationsãƒ†ãƒ¼ãƒ–ãƒ«ã«               â”‚
       â”‚    ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ                        â”‚
       â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ tokenç”Ÿæˆ    â”‚                               â”‚
â”‚ (UUID v4)    â”‚                               â”‚
â”‚ æœ‰åŠ¹æœŸé™:7æ—¥ â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
       â”‚                                        â”‚
       â”‚ 3. ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼                      â”‚
       â”‚    ï¼ˆLINE/ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ï¼‰               â”‚
       â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚https://app/  â”‚    4. ãƒªãƒ³ã‚¯å…±æœ‰              â”‚
â”‚invite/[token]â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
                                               â”‚ 5. ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ /invite/[token]â”‚
                                        â”‚    ãƒšãƒ¼ã‚¸     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ 6. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ãƒ»æœ‰åŠ¹æœŸé™ç¢ºèª â”‚
                                        â”‚ãƒ»ä½¿ç”¨æ¸ˆã¿ç¢ºèª â”‚
                                        â”‚ãƒ»å®¶è¨ˆæƒ…å ±è¡¨ç¤º â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ 7. Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ/æ›´æ–°â”‚
                                        â”‚household_idè¨­å®šâ”‚
                                        â”‚invitationç„¡åŠ¹åŒ–â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ 8. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

```typescript
// middleware.ts
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  let supabaseResponse = NextResponse.next({ request })

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) =>
            request.cookies.set(name, value)
          )
          supabaseResponse = NextResponse.next({ request })
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          )
        },
      },
    }
  )

  const { data: { user } } = await supabase.auth.getUser()

  // æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¿è­·ãƒ«ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯
  if (!user && !request.nextUrl.pathname.startsWith('/login')
           && !request.nextUrl.pathname.startsWith('/invite')
           && !request.nextUrl.pathname.startsWith('/api/auth')) {
    const url = request.nextUrl.clone()
    url.pathname = '/login'
    return NextResponse.redirect(url)
  }

  // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (user && request.nextUrl.pathname.startsWith('/login')) {
    const url = request.nextUrl.clone()
    url.pathname = '/'
    return NextResponse.redirect(url)
  }

  return supabaseResponse
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
}
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ERå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ER Diagram                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    households     â”‚
                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â”‚ id (PK)           â”‚
                              â”‚ name              â”‚
                              â”‚ line_notify_token â”‚
                              â”‚ high_amount_threshold â”‚
                              â”‚ reset_day         â”‚
                              â”‚ created_at        â”‚
                              â”‚ updated_at        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                           â”‚                           â”‚
            â”‚ 1:N                       â”‚ 1:N                       â”‚ 1:N
            â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users        â”‚       â”‚    categories     â”‚       â”‚   invitations     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚       â”‚ id (PK)           â”‚       â”‚ id (PK)           â”‚
â”‚ email             â”‚       â”‚ household_id (FK) â”‚       â”‚ household_id (FK) â”‚
â”‚ name              â”‚       â”‚ name              â”‚       â”‚ token             â”‚
â”‚ nickname          â”‚       â”‚ icon              â”‚       â”‚ expires_at        â”‚
â”‚ avatar_url        â”‚       â”‚ sort_order        â”‚       â”‚ used_at           â”‚
â”‚ household_id (FK) â”‚       â”‚ is_active         â”‚       â”‚ created_by (FK)   â”‚
â”‚ role              â”‚       â”‚ created_at        â”‚       â”‚ created_at        â”‚
â”‚ created_at        â”‚       â”‚ updated_at        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ updated_at        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
          â”‚                           â”‚ 1:N
          â”‚                           â–¼
          â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚      rules        â”‚
          â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                 â”‚ id (PK)           â”‚
          â”‚                 â”‚ household_id (FK) â”‚
          â”‚                 â”‚ category_id (FK)  â”‚
          â”‚                 â”‚ monthly_limit     â”‚
          â”‚                 â”‚ is_active         â”‚
          â”‚                 â”‚ created_at        â”‚
          â”‚                 â”‚ updated_at        â”‚
          â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 1:N
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     expenses      â”‚       â”‚   subscriptions   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚       â”‚ id (PK)           â”‚
â”‚ household_id (FK) â”‚       â”‚ household_id (FK) â”‚
â”‚ user_id (FK)      â”‚       â”‚ category_id (FK)  â”‚
â”‚ category_id (FK)  â”‚       â”‚ name              â”‚
â”‚ amount            â”‚       â”‚ monthly_amount    â”‚
â”‚ date              â”‚       â”‚ contract_date     â”‚
â”‚ memo              â”‚       â”‚ renewal_date      â”‚
â”‚ created_at        â”‚       â”‚ memo              â”‚
â”‚ updated_at        â”‚       â”‚ is_active         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ created_at        â”‚
                            â”‚ updated_at        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

```sql
-- =====================================================
-- householdsï¼ˆå®¶è¨ˆï¼‰
-- =====================================================
CREATE TABLE households (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL DEFAULT 'æˆ‘ãŒå®¶ã®å®¶è¨ˆ',
  line_notify_token TEXT,  -- æš—å·åŒ–ã—ã¦ä¿å­˜
  high_amount_threshold INTEGER NOT NULL DEFAULT 5000,  -- é«˜é¡æ”¯å‡ºã®é–¾å€¤ï¼ˆå††ï¼‰
  reset_day INTEGER NOT NULL DEFAULT 1 CHECK (reset_day >= 1 AND reset_day <= 28),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE households IS 'å®¶è¨ˆï¼ˆå¤«å©¦ã§å…±æœ‰ã™ã‚‹å˜ä½ï¼‰';
COMMENT ON COLUMN households.reset_day IS 'æœˆæ¬¡ãƒªã‚»ãƒƒãƒˆæ—¥ï¼ˆ1-28æ—¥ï¼‰';
COMMENT ON COLUMN households.high_amount_threshold IS 'é«˜é¡æ”¯å‡ºã¨ã¿ãªã™é–¾å€¤ï¼ˆå††ï¼‰';

-- =====================================================
-- usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
-- =====================================================
CREATE TYPE user_role AS ENUM ('owner', 'member');

CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email VARCHAR(255) NOT NULL,
  name VARCHAR(100) NOT NULL,
  nickname VARCHAR(50),  -- è¡¨ç¤ºç”¨ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰
  avatar_url TEXT,
  household_id UUID REFERENCES households(id) ON DELETE SET NULL,
  role user_role NOT NULL DEFAULT 'member',  -- ãƒ­ãƒ¼ãƒ«ï¼ˆowner: æ‰€æœ‰è€…, member: ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE users IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
COMMENT ON COLUMN users.nickname IS 'è¡¨ç¤ºç”¨ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä¾‹ï¼šå¤«ã€å¦»ï¼‰';
COMMENT ON COLUMN users.role IS 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ï¼ˆowner: æ‰€æœ‰è€…, member: ãƒ¡ãƒ³ãƒãƒ¼ï¼‰';

-- =====================================================
-- invitationsï¼ˆæ‹›å¾…ï¼‰
-- =====================================================
CREATE TABLE invitations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  household_id UUID NOT NULL REFERENCES households(id) ON DELETE CASCADE,
  token UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
  expires_at TIMESTAMPTZ NOT NULL DEFAULT (NOW() + INTERVAL '7 days'),
  used_at TIMESTAMPTZ,  -- ä½¿ç”¨æ¸ˆã¿ã®å ´åˆã¯ä½¿ç”¨æ—¥æ™‚
  created_by UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE invitations IS 'æ‹›å¾…ãƒªãƒ³ã‚¯';
CREATE INDEX idx_invitations_token ON invitations(token);

-- =====================================================
-- categoriesï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰
-- =====================================================
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  household_id UUID NOT NULL REFERENCES households(id) ON DELETE CASCADE,
  name VARCHAR(50) NOT NULL,
  icon VARCHAR(50) DEFAULT 'ğŸ“',  -- çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³
  sort_order INTEGER NOT NULL DEFAULT 0,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(household_id, name)
);

COMMENT ON TABLE categories IS 'ã‚«ãƒ†ã‚´ãƒª';
CREATE INDEX idx_categories_household ON categories(household_id);

-- =====================================================
-- rulesï¼ˆå›æ•°ãƒ«ãƒ¼ãƒ«ï¼‰
-- =====================================================
CREATE TABLE rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  household_id UUID NOT NULL REFERENCES households(id) ON DELETE CASCADE,
  category_id UUID NOT NULL REFERENCES categories(id) ON DELETE CASCADE,
  monthly_limit INTEGER NOT NULL CHECK (monthly_limit > 0),
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(household_id, category_id)
);

COMMENT ON TABLE rules IS 'å›æ•°ãƒ«ãƒ¼ãƒ«';
COMMENT ON COLUMN rules.monthly_limit IS 'æœˆé–“ä¸Šé™å›æ•°';

-- =====================================================
-- expensesï¼ˆæ”¯å‡ºï¼‰
-- =====================================================
CREATE TABLE expenses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  household_id UUID NOT NULL REFERENCES households(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  category_id UUID NOT NULL REFERENCES categories(id) ON DELETE RESTRICT,
  amount INTEGER NOT NULL CHECK (amount > 0),
  date DATE NOT NULL DEFAULT CURRENT_DATE,
  memo TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE expenses IS 'æ”¯å‡º';
CREATE INDEX idx_expenses_household_date ON expenses(household_id, date DESC);
CREATE INDEX idx_expenses_user ON expenses(user_id);
CREATE INDEX idx_expenses_category ON expenses(category_id);

-- =====================================================
-- subscriptionsï¼ˆã‚µãƒ–ã‚¹ã‚¯ï¼‰
-- =====================================================
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  household_id UUID NOT NULL REFERENCES households(id) ON DELETE CASCADE,
  category_id UUID NOT NULL REFERENCES categories(id) ON DELETE RESTRICT,
  name VARCHAR(100) NOT NULL,
  monthly_amount INTEGER NOT NULL CHECK (monthly_amount > 0),
  contract_date DATE NOT NULL,
  renewal_date DATE,
  memo TEXT,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE subscriptions IS 'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³';
COMMENT ON COLUMN subscriptions.category_id IS 'ã‚«ãƒ†ã‚´ãƒªï¼ˆã‚µãƒ–ã‚¹ã‚¯ç­‰ã‚’ç®¡ç†ï¼‰';
CREATE INDEX idx_subscriptions_household ON subscriptions(household_id);

-- =====================================================
-- updated_atè‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
-- =====================================================
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_households_updated_at
  BEFORE UPDATE ON households
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_users_updated_at
  BEFORE UPDATE ON users
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_categories_updated_at
  BEFORE UPDATE ON categories
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_rules_updated_at
  BEFORE UPDATE ON rules
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_expenses_updated_at
  BEFORE UPDATE ON expenses
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_subscriptions_updated_at
  BEFORE UPDATE ON subscriptions
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

### 4.3 åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆã‚·ãƒ¼ãƒ‰ï¼‰

```sql
-- ã‚«ãƒ†ã‚´ãƒªåˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆæ–°è¦å®¶è¨ˆä½œæˆæ™‚ã«æŒ¿å…¥ï¼‰
INSERT INTO categories (household_id, name, icon, sort_order) VALUES
  (:household_id, 'é£Ÿè²»', 'ğŸš', 1),
  (:household_id, 'å¤–é£Ÿ', 'ğŸ½ï¸', 2),
  (:household_id, 'æ—¥ç”¨å“', 'ğŸ§´', 3),
  (:household_id, 'äº¤é€šè²»', 'ğŸšƒ', 4),
  (:household_id, 'å¨¯æ¥½', 'ğŸ®', 5),
  (:household_id, 'ã‚µãƒ–ã‚¹ã‚¯', 'ğŸ’³', 6),
  (:household_id, 'è¡£æœ', 'ğŸ‘•', 7),
  (:household_id, 'åŒ»ç™‚', 'ğŸ¥', 8),
  (:household_id, 'é å‡º', 'ğŸš—', 9),
  (:household_id, 'ãã®ä»–', 'ğŸ“¦', 10);
```

### 4.4 Row Level Security (RLS)

```sql
-- =====================================================
-- RLSãƒãƒªã‚·ãƒ¼
-- =====================================================

-- RLSæœ‰åŠ¹åŒ–
ALTER TABLE households ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE invitations ENABLE ROW LEVEL SECURITY;
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE rules ENABLE ROW LEVEL SECURITY;
ALTER TABLE expenses ENABLE ROW LEVEL SECURITY;
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;

-- -----------------------------------------------------
-- households
-- -----------------------------------------------------
CREATE POLICY "Users can view own household"
  ON households FOR SELECT
  USING (
    id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can update own household"
  ON households FOR UPDATE
  USING (
    id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Authenticated users can create household"
  ON households FOR INSERT
  WITH CHECK (auth.uid() IS NOT NULL);

-- -----------------------------------------------------
-- users
-- -----------------------------------------------------
CREATE POLICY "Users can view household members"
  ON users FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
    OR id = auth.uid()
  );

CREATE POLICY "Users can update own profile"
  ON users FOR UPDATE
  USING (id = auth.uid());

CREATE POLICY "Users can insert own profile"
  ON users FOR INSERT
  WITH CHECK (id = auth.uid());

-- -----------------------------------------------------
-- invitations
-- -----------------------------------------------------
CREATE POLICY "Users can view own household invitations"
  ON invitations FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
    OR used_at IS NULL  -- æœªä½¿ç”¨ã®æ‹›å¾…ã¯èª°ã§ã‚‚è¦‹ã‚Œã‚‹ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ç”¨ï¼‰
  );

CREATE POLICY "Users can create invitation for own household"
  ON invitations FOR INSERT
  WITH CHECK (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can update invitations"
  ON invitations FOR UPDATE
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
    OR used_at IS NULL  -- æ‹›å¾…å—è«¾æ™‚ã®æ›´æ–°ç”¨
  );

-- -----------------------------------------------------
-- categories
-- -----------------------------------------------------
CREATE POLICY "Users can view own household categories"
  ON categories FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can manage own household categories"
  ON categories FOR ALL
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

-- -----------------------------------------------------
-- rules
-- -----------------------------------------------------
CREATE POLICY "Users can view own household rules"
  ON rules FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can manage own household rules"
  ON rules FOR ALL
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

-- -----------------------------------------------------
-- expenses
-- -----------------------------------------------------
CREATE POLICY "Users can view own household expenses"
  ON expenses FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can create expenses for own household"
  ON expenses FOR INSERT
  WITH CHECK (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
    AND user_id = auth.uid()
  );

CREATE POLICY "Users can update own expenses"
  ON expenses FOR UPDATE
  USING (user_id = auth.uid());

CREATE POLICY "Users can delete own expenses"
  ON expenses FOR DELETE
  USING (user_id = auth.uid());

-- -----------------------------------------------------
-- subscriptions
-- -----------------------------------------------------
CREATE POLICY "Users can view own household subscriptions"
  ON subscriptions FOR SELECT
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );

CREATE POLICY "Users can manage own household subscriptions"
  ON subscriptions FOR ALL
  USING (
    household_id IN (SELECT household_id FROM users WHERE id = auth.uid())
  );
```

### 4.5 ãƒ“ãƒ¥ãƒ¼ãƒ»é–¢æ•°

```sql
-- =====================================================
-- æœˆé–“é›†è¨ˆãƒ“ãƒ¥ãƒ¼
-- =====================================================
CREATE OR REPLACE VIEW monthly_expense_summary AS
SELECT
  e.household_id,
  e.category_id,
  c.name AS category_name,
  DATE_TRUNC('month', e.date) AS month,
  COUNT(*) AS count,
  SUM(e.amount) AS total_amount
FROM expenses e
JOIN categories c ON e.category_id = c.id
GROUP BY e.household_id, e.category_id, c.name, DATE_TRUNC('month', e.date);

-- =====================================================
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æœˆé–“é›†è¨ˆãƒ“ãƒ¥ãƒ¼
-- =====================================================
CREATE OR REPLACE VIEW monthly_user_expense_summary AS
SELECT
  e.household_id,
  e.user_id,
  u.name AS user_name,
  u.nickname AS user_nickname,
  DATE_TRUNC('month', e.date) AS month,
  COUNT(*) AS count,
  SUM(e.amount) AS total_amount
FROM expenses e
JOIN users u ON e.user_id = u.id
GROUP BY e.household_id, e.user_id, u.name, u.nickname, DATE_TRUNC('month', e.date);

-- =====================================================
-- æœˆé–“æœŸé–“è¨ˆç®—é–¢æ•°
-- =====================================================
CREATE OR REPLACE FUNCTION get_current_period(household_id UUID)
RETURNS TABLE (start_date DATE, end_date DATE) AS $$
DECLARE
  reset_day INTEGER;
  today DATE := CURRENT_DATE;
  period_start DATE;
  period_end DATE;
BEGIN
  -- å®¶è¨ˆã®ãƒªã‚»ãƒƒãƒˆæ—¥ã‚’å–å¾—
  SELECT h.reset_day INTO reset_day
  FROM households h
  WHERE h.id = household_id;

  IF reset_day IS NULL THEN
    reset_day := 1;
  END IF;

  -- æœŸé–“è¨ˆç®—
  IF EXTRACT(DAY FROM today) >= reset_day THEN
    period_start := DATE_TRUNC('month', today) + (reset_day - 1) * INTERVAL '1 day';
    period_end := (DATE_TRUNC('month', today) + INTERVAL '1 month' + (reset_day - 2) * INTERVAL '1 day')::DATE;
  ELSE
    period_start := (DATE_TRUNC('month', today) - INTERVAL '1 month' + (reset_day - 1) * INTERVAL '1 day')::DATE;
    period_end := (DATE_TRUNC('month', today) + (reset_day - 2) * INTERVAL '1 day')::DATE;
  END IF;

  RETURN QUERY SELECT period_start, period_end;
END;
$$ LANGUAGE plpgsql;

-- =====================================================
-- æ®‹ã‚Šå›æ•°è¨ˆç®—é–¢æ•°
-- =====================================================
CREATE OR REPLACE FUNCTION get_remaining_counts(p_household_id UUID)
RETURNS TABLE (
  category_id UUID,
  category_name VARCHAR,
  monthly_limit INTEGER,
  current_count BIGINT,
  remaining_count BIGINT
) AS $$
DECLARE
  period_start DATE;
  period_end DATE;
BEGIN
  -- ç¾åœ¨ã®æœŸé–“ã‚’å–å¾—
  SELECT gcp.start_date, gcp.end_date
  INTO period_start, period_end
  FROM get_current_period(p_household_id) gcp;

  RETURN QUERY
  SELECT
    r.category_id,
    c.name AS category_name,
    r.monthly_limit,
    COALESCE(COUNT(e.id), 0) AS current_count,
    GREATEST(r.monthly_limit - COALESCE(COUNT(e.id), 0), 0) AS remaining_count
  FROM rules r
  JOIN categories c ON r.category_id = c.id
  LEFT JOIN expenses e ON e.category_id = r.category_id
    AND e.household_id = p_household_id
    AND e.date BETWEEN period_start AND period_end
  WHERE r.household_id = p_household_id
    AND r.is_active = TRUE
  GROUP BY r.category_id, c.name, r.monthly_limit;
END;
$$ LANGUAGE plpgsql;
```

---

## 5. APIè¨­è¨ˆ

### 5.1 API Routesä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---------|--------------|------|
| GET | `/api/auth/callback` | OAuth2ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| POST | `/api/line/notify` | LINEé€šçŸ¥é€ä¿¡ |

### 5.2 Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ“ä½œ

TanStack Queryã‚’ä½¿ç”¨ã—ã¦Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç›´æ¥æ“ä½œã—ã¾ã™ã€‚

```typescript
// lib/queries/expenses.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { createClient } from '@/lib/supabase/client'

// æ”¯å‡ºä¸€è¦§å–å¾—
export function useExpenses(householdId: string, month: Date) {
  return useQuery({
    queryKey: ['expenses', householdId, month.toISOString()],
    queryFn: async () => {
      const supabase = createClient()
      const startOfMonth = new Date(month.getFullYear(), month.getMonth(), 1)
      const endOfMonth = new Date(month.getFullYear(), month.getMonth() + 1, 0)

      const { data, error } = await supabase
        .from('expenses')
        .select(`
          *,
          category:categories(id, name, icon),
          user:users(id, name, nickname, avatar_url)
        `)
        .eq('household_id', householdId)
        .gte('date', startOfMonth.toISOString())
        .lte('date', endOfMonth.toISOString())
        .order('date', { ascending: false })

      if (error) throw error
      return data
    },
  })
}

// æ”¯å‡ºä½œæˆ
export function useCreateExpense() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: async (expense: CreateExpenseInput) => {
      const supabase = createClient()
      const { data, error } = await supabase
        .from('expenses')
        .insert(expense)
        .select()
        .single()

      if (error) throw error

      // LINEé€šçŸ¥é€ä¿¡
      await fetch('/api/line/notify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ expenseId: data.id }),
      })

      return data
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ['expenses'] })
      queryClient.invalidateQueries({ queryKey: ['dashboard'] })
    },
  })
}
```

### 5.3 LINEé€šçŸ¥API

```typescript
// app/api/line/notify/route.ts
import { createClient } from '@/lib/supabase/server'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  try {
    const { expenseId } = await request.json()
    const supabase = await createClient()

    // æ”¯å‡ºæƒ…å ±ã‚’å–å¾—
    const { data: expense, error: expenseError } = await supabase
      .from('expenses')
      .select(`
        *,
        category:categories(name),
        user:users(name, nickname),
        household:households(line_notify_token, high_amount_threshold)
      `)
      .eq('id', expenseId)
      .single()

    if (expenseError || !expense) {
      return NextResponse.json({ error: 'Expense not found' }, { status: 404 })
    }

    const token = expense.household?.line_notify_token
    if (!token) {
      return NextResponse.json({ message: 'LINE not configured' }, { status: 200 })
    }

    // æ®‹ã‚Šå›æ•°ã‚’å–å¾—
    const { data: remaining } = await supabase
      .rpc('get_remaining_counts', { p_household_id: expense.household_id })

    const categoryRemaining = remaining?.find(
      (r: any) => r.category_id === expense.category_id
    )

    // é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
    const userName = expense.user?.nickname || expense.user?.name
    const threshold = expense.household?.high_amount_threshold || 5000
    const isHighAmount = expense.amount >= threshold

    let message = `ã€æ”¯å‡ºç™»éŒ²ã€‘\n`
    message += `ğŸ‘¤ ${userName}\n`
    message += `ğŸ“ ${expense.category?.name}\n`
    message += `ğŸ’° Â¥${expense.amount.toLocaleString()}\n`
    if (expense.memo) {
      message += `ğŸ“ ${expense.memo}\n`
    }
    if (categoryRemaining) {
      const remaining = categoryRemaining.remaining_count
      if (remaining <= 1) {
        message += `âš ï¸ ${expense.category?.name} æ®‹ã‚Š${remaining}å›\n`
      } else {
        message += `ğŸ“Š ${expense.category?.name} æ®‹ã‚Š${remaining}å›\n`
      }
    }
    if (isHighAmount) {
      message += `ğŸ”” é«˜é¡æ”¯å‡ºã§ã™ï¼`
    }

    // LINE Notifyé€ä¿¡
    const response = await fetch('https://notify-api.line.me/api/notify', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({ message }),
    })

    if (!response.ok) {
      throw new Error('LINE Notify failed')
    }

    return NextResponse.json({ success: true })
  } catch (error) {
    console.error('LINE notify error:', error)
    return NextResponse.json({ error: 'Internal error' }, { status: 500 })
  }
}
```

---

## 6. ç”»é¢è¨­è¨ˆ

### 6.1 ç”»é¢ä¸€è¦§

| # | ç”»é¢ | ãƒ‘ã‚¹ | èª¬æ˜ |
|---|------|------|------|
| S01 | ãƒ­ã‚°ã‚¤ãƒ³ | `/login` | Googleãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ |
| S02 | æ‹›å¾…å—è«¾ | `/invite/[token]` | æ‹›å¾…ãƒªãƒ³ã‚¯ã‹ã‚‰ã®å‚åŠ  |
| S03 | å®¶è¨ˆä½œæˆ | `/setup` | æ–°è¦å®¶è¨ˆä½œæˆ |
| S04 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | `/` | ãƒ¡ã‚¤ãƒ³ç”»é¢ |
| S05 | æ”¯å‡ºå…¥åŠ› | `/expenses/new` | æ”¯å‡ºç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  |
| S06 | æ”¯å‡ºå±¥æ­´ | `/expenses` | æœˆåˆ¥æ”¯å‡ºä¸€è¦§ |
| S07 | åˆ†æ | `/analytics` | ã‚°ãƒ©ãƒ•ãƒ»çµ±è¨ˆ |
| S08 | ã‚µãƒ–ã‚¹ã‚¯ç®¡ç† | `/subscriptions` | ã‚µãƒ–ã‚¹ã‚¯ä¸€è¦§ãƒ»ç™»éŒ² |
| S09 | è¨­å®š | `/settings` | è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ |
| S10 | ã‚«ãƒ†ã‚´ãƒªç®¡ç† | `/settings/categories` | ã‚«ãƒ†ã‚´ãƒªCRUD |
| S11 | ãƒ«ãƒ¼ãƒ«è¨­å®š | `/settings/rules` | å›æ•°ãƒ«ãƒ¼ãƒ«è¨­å®š |
| S12 | å®¶è¨ˆè¨­å®š | `/settings/household` | å®¶è¨ˆæƒ…å ±ãƒ»æ‹›å¾…ãƒ»é«˜é¡é–¾å€¤è¨­å®š |
| S13 | LINEé€£æº | `/settings/line` | LINE Notifyè¨­å®š |

### 6.2 ç”»é¢é·ç§»å›³

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   Login     â”‚
                                    â”‚   (S01)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚               â”‚               â”‚
                           â–¼               â–¼               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Setup     â”‚ â”‚   Invite    â”‚ â”‚  Dashboard  â”‚
                    â”‚   (S03)     â”‚ â”‚   (S02)     â”‚ â”‚   (S04)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚               â”‚               â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚               â”‚               â”‚             â”‚             â”‚
     â–¼               â–¼               â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Expenses â”‚   â”‚Expenses â”‚   â”‚Analyticsâ”‚   â”‚ Subscr  â”‚   â”‚Settings â”‚
â”‚   New   â”‚   â”‚  List   â”‚   â”‚  (S07)  â”‚   â”‚ (S08)   â”‚   â”‚  (S09)  â”‚
â”‚  (S05)  â”‚   â”‚  (S06)  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚                 â”‚                 â”‚
                                           â–¼                 â–¼                 â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Categories  â”‚   â”‚   Rules     â”‚   â”‚  Household  â”‚
                                    â”‚   (S10)     â”‚   â”‚   (S11)     â”‚   â”‚   (S12)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                               â”‚
                                                                               â–¼
                                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                        â”‚    LINE     â”‚
                                                                        â”‚   (S13)     â”‚
                                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ä¸»è¦ç”»é¢ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 

#### S04: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‰¡  æˆ‘ãŒå®¶ã®å®¶è¨ˆ                                    ğŸ‘¤ å±±ç”°å¤ªéƒ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  2026å¹´1æœˆ                              < ä»Šæœˆ >          â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ç·æ”¯å‡º  Â¥125,000                                        â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚ â”‚
â”‚  â”‚  ã‚µãƒ–ã‚¹ã‚¯ Â¥25,000  |  å¤‰å‹•è²» Â¥100,000                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å›æ•°åˆ¶é™ã‚«ãƒ†ã‚´ãƒª                                         â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ½ï¸ å¤–é£Ÿ        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  3/4å›      æ®‹ã‚Š1å›         â”‚ â”‚
â”‚  â”‚                                          âš ï¸ ã‚‚ã†ã™ãä¸Šé™  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸ® å¨¯æ¥½        â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1/3å›      æ®‹ã‚Š2å›         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ğŸš— é å‡º        â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0/2å›      æ®‹ã‚Š2å›         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ã‚«ãƒ†ã‚´ãƒªåˆ¥å†…è¨³          â”‚ â”‚  å¤«å©¦åˆ¥æ”¯å‡º                  â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚  â”‚
â”‚  â”‚                         â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”              â”‚ â”‚   å±±ç”°å¤ªéƒ    å±±ç”°èŠ±å­       â”‚  â”‚
â”‚  â”‚    â•±     â•²             â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚   â”‚  å††   â”‚            â”‚ â”‚   â”‚     â”‚    â”‚     â”‚       â”‚  â”‚
â”‚  â”‚   â”‚ ã‚°ãƒ©ãƒ• â”‚            â”‚ â”‚   â”‚ 60% â”‚    â”‚ 40% â”‚       â”‚  â”‚
â”‚  â”‚    â•²     â•±             â”‚ â”‚   â”‚     â”‚    â”‚     â”‚       â”‚  â”‚
â”‚  â”‚      â””â”€â”€â”€â”˜              â”‚ â”‚   â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                         â”‚ â”‚   Â¥75,000    Â¥50,000       â”‚  â”‚
â”‚  â”‚  ğŸš é£Ÿè²»     35%        â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  ğŸ½ï¸ å¤–é£Ÿ     25%        â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  ğŸ® å¨¯æ¥½     20%        â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  ğŸ“¦ ãã®ä»–   20%        â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚                         â”‚ â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç›´è¿‘ã®æ”¯å‡º                                    ã‚‚ã£ã¨è¦‹ã‚‹ > â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  1/18  ğŸ½ï¸ å¤–é£Ÿ      Â¥3,500   å±±ç”°å¤ªéƒ   ãƒ©ãƒ³ãƒ           â”‚ â”‚
â”‚  â”‚  1/17  ğŸš é£Ÿè²»      Â¥2,800   å±±ç”°èŠ±å­   ã‚¹ãƒ¼ãƒ‘ãƒ¼         â”‚ â”‚
â”‚  â”‚  1/16  ğŸ® å¨¯æ¥½      Â¥1,500   å±±ç”°å¤ªéƒ   ã‚²ãƒ¼ãƒ            â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ         ğŸ“        ğŸ“Š        ğŸ’³        âš™ï¸                  â”‚
â”‚ ãƒ›ãƒ¼ãƒ     å…¥åŠ›      åˆ†æ     ã‚µãƒ–ã‚¹ã‚¯    è¨­å®š                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S05: æ”¯å‡ºå…¥åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â†  æ”¯å‡ºã‚’å…¥åŠ›                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ—¥ä»˜                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  2026å¹´1æœˆ18æ—¥ï¼ˆåœŸï¼‰                            ğŸ“…  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é‡‘é¡                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Â¥                                            3,500 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  âš ï¸ è¨­å®šã—ãŸé–¾å€¤ä»¥ä¸Šã®é«˜é¡æ”¯å‡ºã§ã™                        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ã‚«ãƒ†ã‚´ãƒª                                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚ ğŸš  â”‚ â”‚ ğŸ½ï¸  â”‚ â”‚ ğŸ§´  â”‚ â”‚ ğŸšƒ  â”‚ â”‚ ğŸ®  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚é£Ÿè²» â”‚ â”‚å¤–é£Ÿ â”‚ â”‚æ—¥ç”¨å“â”‚ â”‚äº¤é€šè²»â”‚ â”‚å¨¯æ¥½ â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ’³  â”‚ â”‚ ğŸ‘•  â”‚ â”‚ ğŸ¥  â”‚ â”‚ ğŸš—  â”‚ â”‚ ğŸ“¦  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ã‚µãƒ–ã‚¹ã‚¯â”‚ â”‚è¡£æœ â”‚ â”‚åŒ»ç™‚ â”‚ â”‚é å‡º â”‚ â”‚ãã®ä»–â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  é¸æŠä¸­: ğŸ½ï¸ å¤–é£Ÿ                                         â”‚ â”‚
â”‚  â”‚  âš ï¸ å¤–é£Ÿã¯ä»Šæœˆæ®‹ã‚Š1å›ã§ã™                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  ãƒ©ãƒ³ãƒ                                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚                      ç™»éŒ²ã™ã‚‹                            â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S06: æ”¯å‡ºå±¥æ­´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‰¡  æ”¯å‡ºå±¥æ­´                                        ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       â—€ï¸     2026å¹´1æœˆ     â–¶ï¸                             â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  åˆè¨ˆ: Â¥125,000  (32ä»¶)                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ãƒ•ã‚£ãƒ«ã‚¿                                           Ã— é–‰ã˜ã‚‹ â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ã‚«ãƒ†ã‚´ãƒª        å…¥åŠ›è€…                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚ â”‚
â”‚  â”‚  â”‚ ã™ã¹ã¦ â–¼ â”‚   â”‚ ã™ã¹ã¦ â–¼ â”‚                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ä¸¦ã³é †                                                  â”‚ â”‚
â”‚  â”‚  â—‹ æ—¥ä»˜ï¼ˆæ–°ã—ã„é †ï¼‰  â—‹ æ—¥ä»˜ï¼ˆå¤ã„é †ï¼‰  â—‹ é‡‘é¡ï¼ˆé«˜ã„é †ï¼‰   â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”€â”€ 1æœˆ18æ—¥ï¼ˆåœŸï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ½ï¸ å¤–é£Ÿ                           Â¥3,500    å±±ç”°å¤ªéƒ     â”‚ â”‚
â”‚  â”‚  ãƒ©ãƒ³ãƒ                                                   â”‚ â”‚
â”‚  â”‚                                                  ï¸™ ç·¨é›†   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸš é£Ÿè²»                           Â¥2,100    å±±ç”°èŠ±å­     â”‚ â”‚
â”‚  â”‚  ã‚¹ãƒ¼ãƒ‘ãƒ¼                                                 â”‚ â”‚
â”‚  â”‚                                                  ï¸™ ç·¨é›†   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”€â”€ 1æœˆ17æ—¥ï¼ˆé‡‘ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸšƒ äº¤é€šè²»                          Â¥800    å±±ç”°å¤ªéƒ      â”‚ â”‚
â”‚  â”‚  é›»è»Š                                                     â”‚ â”‚
â”‚  â”‚                                                  ï¸™ ç·¨é›†   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚                         ...                                    â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ         ğŸ“        ğŸ“Š        ğŸ’³        âš™ï¸                  â”‚
â”‚ ãƒ›ãƒ¼ãƒ     å…¥åŠ›      åˆ†æ     ã‚µãƒ–ã‚¹ã‚¯    è¨­å®š                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 7.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆå›³

```
components/
â”œâ”€â”€ ui/                          # shadcn/ui ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ button.tsx
â”‚   â”œâ”€â”€ card.tsx
â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”œâ”€â”€ input.tsx
â”‚   â”œâ”€â”€ select.tsx
â”‚   â”œâ”€â”€ toast.tsx
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ layout/                      # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ header.tsx              # ãƒ˜ãƒƒãƒ€ãƒ¼
â”‚   â”œâ”€â”€ sidebar.tsx             # ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆPCï¼‰
â”‚   â”œâ”€â”€ bottom-nav.tsx          # ãƒœãƒˆãƒ ãƒŠãƒ“ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
â”‚   â””â”€â”€ page-container.tsx      # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ
â”‚
â”œâ”€â”€ features/                    # æ©Ÿèƒ½åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login-button.tsx
â”‚   â”‚   â””â”€â”€ user-menu.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ expenses/
â”‚   â”‚   â”œâ”€â”€ expense-form.tsx
â”‚   â”‚   â”œâ”€â”€ expense-list.tsx
â”‚   â”‚   â”œâ”€â”€ expense-item.tsx
â”‚   â”‚   â””â”€â”€ expense-edit-dialog.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ summary-card.tsx
â”‚   â”‚   â”œâ”€â”€ remaining-counts.tsx
â”‚   â”‚   â”œâ”€â”€ category-pie-chart.tsx
â”‚   â”‚   â”œâ”€â”€ user-comparison-chart.tsx
â”‚   â”‚   â””â”€â”€ recent-expenses.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â”œâ”€â”€ category-list.tsx
â”‚   â”‚   â”œâ”€â”€ category-form.tsx
â”‚   â”‚   â””â”€â”€ category-picker.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ rules/
â”‚   â”‚   â”œâ”€â”€ rule-list.tsx
â”‚   â”‚   â””â”€â”€ rule-form.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”œâ”€â”€ subscription-list.tsx
â”‚   â”‚   â”œâ”€â”€ subscription-form.tsx
â”‚   â”‚   â””â”€â”€ subscription-summary.tsx
â”‚   â”‚
â”‚   â””â”€â”€ settings/
â”‚       â”œâ”€â”€ household-settings.tsx
â”‚       â”œâ”€â”€ invite-link.tsx
â”‚       â””â”€â”€ line-settings.tsx
â”‚
â””â”€â”€ shared/                      # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”œâ”€â”€ loading-spinner.tsx
    â”œâ”€â”€ empty-state.tsx
    â”œâ”€â”€ error-boundary.tsx
    â”œâ”€â”€ confirm-dialog.tsx
    â”œâ”€â”€ date-picker.tsx
    â”œâ”€â”€ amount-input.tsx
    â””â”€â”€ month-picker.tsx
```

### 7.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•æ§˜

#### ExpenseForm

```typescript
// components/features/expenses/expense-form.tsx
interface ExpenseFormProps {
  defaultValues?: Partial<ExpenseFormValues>
  onSuccess?: () => void
}

interface ExpenseFormValues {
  date: Date
  amount: number
  categoryId: string
  memo?: string
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ
const expenseSchema = z.object({
  date: z.date(),
  amount: z.number().min(1, 'é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'),
  categoryId: z.string().min(1, 'ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„'),
  memo: z.string().optional(),
})
```

#### CategoryPieChart

```typescript
// components/features/dashboard/category-pie-chart.tsx
interface CategoryPieChartProps {
  data: {
    categoryId: string
    categoryName: string
    icon: string
    amount: number
    percentage: number
  }[]
}

// Rechartsã‚’ä½¿ç”¨
// ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ: ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```

#### UserComparisonChart

```typescript
// components/features/dashboard/user-comparison-chart.tsx
interface UserComparisonChartProps {
  data: {
    userId: string
    userName: string
    nickname?: string
    amount: number
    percentage: number
  }[]
}

// æ¨ªæ£’ã‚°ãƒ©ãƒ•ã¾ãŸã¯ãƒ‰ãƒ¼ãƒŠãƒ„ãƒãƒ£ãƒ¼ãƒˆ
```

---

## 8. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

### 8.1 çŠ¶æ…‹ç®¡ç†æ–¹é‡

| çŠ¶æ…‹ã®ç¨®é¡ | ç®¡ç†æ–¹æ³• | ä¾‹ |
|-----------|---------|-----|
| ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ | TanStack Query | æ”¯å‡ºä¸€è¦§ã€ã‚«ãƒ†ã‚´ãƒªã€ãƒ«ãƒ¼ãƒ« |
| ã‚°ãƒ­ãƒ¼ãƒãƒ«UIçŠ¶æ…‹ | Zustand | ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰ã€ãƒ¢ãƒ¼ãƒ€ãƒ« |
| ãƒ­ãƒ¼ã‚«ãƒ«UIçŠ¶æ…‹ | useState | ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ |
| URLçŠ¶æ…‹ | Next.js Router | æœˆé¸æŠã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ |

### 8.2 TanStack Query ã‚­ãƒ¼è¨­è¨ˆ

```typescript
// lib/queries/query-keys.ts
export const queryKeys = {
  // æ”¯å‡º
  expenses: {
    all: ['expenses'] as const,
    list: (householdId: string, month: string) =>
      ['expenses', 'list', householdId, month] as const,
    detail: (id: string) => ['expenses', 'detail', id] as const,
  },

  // ã‚«ãƒ†ã‚´ãƒª
  categories: {
    all: ['categories'] as const,
    list: (householdId: string) =>
      ['categories', 'list', householdId] as const,
  },

  // ãƒ«ãƒ¼ãƒ«
  rules: {
    all: ['rules'] as const,
    list: (householdId: string) =>
      ['rules', 'list', householdId] as const,
    remaining: (householdId: string) =>
      ['rules', 'remaining', householdId] as const,
  },

  // ã‚µãƒ–ã‚¹ã‚¯
  subscriptions: {
    all: ['subscriptions'] as const,
    list: (householdId: string) =>
      ['subscriptions', 'list', householdId] as const,
  },

  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  dashboard: {
    summary: (householdId: string, month: string) =>
      ['dashboard', 'summary', householdId, month] as const,
  },

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼
  users: {
    current: ['users', 'current'] as const,
    household: (householdId: string) =>
      ['users', 'household', householdId] as const,
  },
}
```

### 8.3 Zustand ã‚¹ãƒˆã‚¢

```typescript
// lib/stores/ui-store.ts
import { create } from 'zustand'

interface UIStore {
  // ã‚µã‚¤ãƒ‰ãƒãƒ¼
  sidebarOpen: boolean
  toggleSidebar: () => void

  // æ”¯å‡ºå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«
  expenseModalOpen: boolean
  openExpenseModal: () => void
  closeExpenseModal: () => void

  // ç·¨é›†ä¸­ã®æ”¯å‡º
  editingExpenseId: string | null
  setEditingExpenseId: (id: string | null) => void
}

export const useUIStore = create<UIStore>((set) => ({
  sidebarOpen: false,
  toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),

  expenseModalOpen: false,
  openExpenseModal: () => set({ expenseModalOpen: true }),
  closeExpenseModal: () => set({ expenseModalOpen: false, editingExpenseId: null }),

  editingExpenseId: null,
  setEditingExpenseId: (id) => set({ editingExpenseId: id, expenseModalOpen: !!id }),
}))
```

---

## 9. å¤–éƒ¨é€£æºè¨­è¨ˆ

### 9.1 LINE Notifyé€£æº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LINE Notify é€£æºãƒ•ãƒ­ãƒ¼                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ãƒ¦ãƒ¼ã‚¶ãƒ¼]                    [ã‚¢ãƒ—ãƒª]                    [LINE Notify]
    â”‚                           â”‚                              â”‚
    â”‚ 1. LINEé€£æºè¨­å®šç”»é¢       â”‚                              â”‚
    â”‚    ã‚’é–‹ã                 â”‚                              â”‚
    â–¼                           â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚                              â”‚
â”‚è¨­å®š > LINEâ”‚                   â”‚                              â”‚
â”‚  é€£æº     â”‚                   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚                              â”‚
      â”‚                         â”‚                              â”‚
      â”‚ 2. LINE Notifyã§        â”‚                              â”‚
      â”‚    ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ         â”‚                              â”‚
      â”‚    ï¼ˆå¤–éƒ¨ã‚µã‚¤ãƒˆï¼‰       â”‚                              â”‚
      â–¼                         â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                              â”‚
â”‚ LINE Notify     â”‚             â”‚                              â”‚
â”‚ ãƒã‚¤ãƒšãƒ¼ã‚¸ã§     â”‚             â”‚                              â”‚
â”‚ ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ     â”‚             â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                              â”‚
         â”‚                      â”‚                              â”‚
         â”‚ 3. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼  â”‚                              â”‚
         â”‚    ã—ã¦ã‚¢ãƒ—ãƒªã«è²¼ä»˜  â”‚                              â”‚
         â–¼                      â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                              â”‚
â”‚ ãƒˆãƒ¼ã‚¯ãƒ³å…¥åŠ›    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
â”‚ ãƒ•ã‚©ãƒ¼ãƒ         â”‚  4. ä¿å­˜    â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                              â”‚
                                â”‚                              â”‚
                                â”‚ 5. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼              â”‚
                                â”‚    ï¼ˆãƒ†ã‚¹ãƒˆé€šçŸ¥é€ä¿¡ï¼‰        â”‚
                                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                                â”‚                              â”‚
                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                â”‚ 6. æˆåŠŸ/å¤±æ•—                 â”‚
                                â”‚                              â”‚
                                â”‚ 7. households.line_notify_   â”‚
                                â”‚    tokenã«ä¿å­˜               â”‚
                                â–¼                              â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
                         â”‚   DBä¿å­˜å®Œäº†  â”‚                      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
```

### 9.2 LINE Notify ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œæ‰‹é †ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰

```
1. https://notify-bot.line.me/ja/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. LINEã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. ãƒã‚¤ãƒšãƒ¼ã‚¸ > ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ
4. ãƒˆãƒ¼ã‚¯ãƒ³å: ã€Œå®¶è¨ˆç°¿ã‚¢ãƒ—ãƒªã€ãªã©ä»»æ„ã®åå‰
5. é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ã‚’é¸æŠ:
   - ã€Œ1:1ã§LINE Notifyã‹ã‚‰é€šçŸ¥ã‚’å—ã‘å–ã‚‹ã€ï¼ˆå€‹äººï¼‰
   - ã¾ãŸã¯å¤«å©¦ã®LINEã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠ
6. ç™ºè¡Œãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
7. è¡¨ç¤ºã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
8. ã‚¢ãƒ—ãƒªã®è¨­å®šç”»é¢ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜
```

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 10.1 èªè¨¼ãƒ»èªå¯

| é …ç›® | å®Ÿè£…æ–¹æ³• |
|------|---------|
| èªè¨¼ | Supabase Auth (Google OAuth 2.0) |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | Supabase ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆJWTï¼‰ |
| èªå¯ | Supabase RLSï¼ˆRow Level Securityï¼‰ |
| CSRFå¯¾ç­– | Next.jsçµ„ã¿è¾¼ã¿ |
| XSSå¯¾ç­– | Reactæ¨™æº–ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— |

### 10.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

```typescript
// LINE Notifyãƒˆãƒ¼ã‚¯ãƒ³ã®æš—å·åŒ–ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
// Supabase Edge Functionsã¾ãŸã¯API Routeã§æš—å·åŒ–/å¾©å·åŒ–

// ç°¡æ˜“çš„ã«ã¯Supabase Vaultã‚’ä½¿ç”¨å¯èƒ½
// https://supabase.com/docs/guides/database/vault
```

### 10.3 ç’°å¢ƒå¤‰æ•°ç®¡ç†

```bash
# .env.localï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_KEY=eyJ...ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰

# Vercelç’°å¢ƒå¤‰æ•°ï¼ˆæœ¬ç•ªç”¨ï¼‰
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_KEY=eyJ...ï¼ˆæœ¬ç•ªç”¨ï¼‰
```

---

## 11. é–‹ç™ºç’°å¢ƒãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ

### 11.1 é–‹ç™ºç’°å¢ƒæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    Mac (é–‹ç™ºãƒã‚·ãƒ³)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Next.js Dev Server                     â”‚ â”‚
â”‚  â”‚                    http://localhost:3000                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Supabase Local                          â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚  PostgreSQL  â”‚  â”‚    Auth     â”‚  â”‚   Studio    â”‚      â”‚ â”‚
â”‚  â”‚  â”‚ :54322      â”‚  â”‚   :54321    â”‚  â”‚   :54323    â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  supabase start ã§èµ·å‹•                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 Supabase Local ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# Supabase CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install supabase/tap/supabase

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
supabase init

# ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•
supabase start

# å‡ºåŠ›ã•ã‚Œã‚‹URLã¨ã‚­ãƒ¼ã‚’.env.localã«è¨­å®š
# API URL: http://localhost:54321
# anon key: eyJ...
# Studio URL: http://localhost:54323

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
supabase migration new create_tables

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
supabase db reset

# åœæ­¢
supabase stop
```

### 11.3 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[é–‹ç™ºè€…]
    â”‚
    â”‚ 1. ã‚³ãƒ¼ãƒ‰å¤‰æ›´
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º â”‚
â”‚  (Supabase   â”‚
â”‚   Local)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. git push
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    GitHub    â”‚â”€â”€â”€â”€â”€â–¶â”‚    Vercel    â”‚
â”‚              â”‚      â”‚  (è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚                      â”‚
       â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Preview    â”‚      â”‚  Production  â”‚      â”‚   Supabase   â”‚
â”‚  (PRæ™‚è‡ªå‹•)   â”‚      â”‚  (main merge) â”‚      â”‚   (æœ¬ç•ªDB)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.4 Supabase ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

```bash
# æœ¬ç•ªç’°å¢ƒã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

# 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆãƒ»ãƒ†ã‚¹ãƒˆ
supabase migration new add_feature
supabase db reset  # ãƒ­ãƒ¼ã‚«ãƒ«ã§é©ç”¨ãƒ†ã‚¹ãƒˆ

# 2. Supabaseæœ¬ç•ªã«ãƒªãƒ³ã‚¯
supabase link --project-ref <project-id>

# 3. æœ¬ç•ªã«ãƒ—ãƒƒã‚·ãƒ¥
supabase db push

# ã¾ãŸã¯ GitHub Actions ã§è‡ªå‹•åŒ–
```

### 11.5 PWAè¨­å®š

```typescript
// next.config.ts
import type { NextConfig } from 'next'
import withPWA from 'next-pwa'

const nextConfig: NextConfig = {
  // Next.jsè¨­å®š
}

export default withPWA({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development',
})(nextConfig)
```

```typescript
// app/manifest.ts
import type { MetadataRoute } from 'next'

export default function manifest(): MetadataRoute.Manifest {
  return {
    name: 'å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª',
    short_name: 'å®¶è¨ˆç°¿',
    description: 'å¤«å©¦å‘ã‘æµªè²»ç®¡ç†ã‚¢ãƒ—ãƒª',
    start_url: '/',
    display: 'standalone',
    background_color: '#FFFBF7',
    theme_color: '#F97316',
    icons: [
      {
        src: '/icons/icon-192x192.png',
        sizes: '192x192',
        type: 'image/png',
      },
      {
        src: '/icons/icon-512x512.png',
        sizes: '512x512',
        type: 'image/png',
      },
    ],
  }
}
```

---

## 12. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
household-expense-app/
â”œâ”€â”€ .env.local                    # ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
â”œâ”€â”€ .env.example                  # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ components.json               # shadcn/uiè¨­å®š
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ invite/
â”‚   â”‚   â”‚   â””â”€â”€ [token]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ expenses/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # æ”¯å‡ºä¸€è¦§
â”‚   â”‚   â”‚   â””â”€â”€ new/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # æ”¯å‡ºå…¥åŠ›
â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â”œâ”€â”€ page.tsx
â”‚   â”‚       â”œâ”€â”€ categories/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”œâ”€â”€ rules/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”œâ”€â”€ household/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â””â”€â”€ line/
â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â””â”€â”€ line/
â”‚   â”‚       â””â”€â”€ notify/
â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ manifest.ts               # PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ globals.css
â”‚   â””â”€â”€ providers.tsx             # QueryClient, Zustandãªã©
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui
â”‚   â”œâ”€â”€ layout/
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ expenses/
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â”œâ”€â”€ rules/
â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â””â”€â”€ shared/
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts             # ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ server.ts             # ã‚µãƒ¼ãƒãƒ¼ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ middleware.ts         # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ç”¨
â”‚   â”œâ”€â”€ queries/
â”‚   â”‚   â”œâ”€â”€ query-keys.ts
â”‚   â”‚   â”œâ”€â”€ expenses.ts
â”‚   â”‚   â”œâ”€â”€ categories.ts
â”‚   â”‚   â”œâ”€â”€ rules.ts
â”‚   â”‚   â”œâ”€â”€ subscriptions.ts
â”‚   â”‚   â””â”€â”€ dashboard.ts
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ ui-store.ts
â”‚   â”œâ”€â”€ validations/
â”‚   â”‚   â”œâ”€â”€ expense.ts
â”‚   â”‚   â”œâ”€â”€ category.ts
â”‚   â”‚   â””â”€â”€ subscription.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date.ts
â”‚       â”œâ”€â”€ format.ts
â”‚       â””â”€â”€ cn.ts                 # clsx + tailwind-merge
â”‚
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ database.ts               # Supabaseç”Ÿæˆå‹
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-user.ts
â”‚   â”œâ”€â”€ use-household.ts
â”‚   â””â”€â”€ use-current-period.ts
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml
â”‚   â”œâ”€â”€ seed.sql
â”‚   â””â”€â”€ migrations/
â”‚       â”œâ”€â”€ 20260118000000_create_tables.sql
â”‚       â””â”€â”€ 20260118000001_create_rls_policies.sql
â”‚
â””â”€â”€ public/
    â”œâ”€â”€ favicon.ico
    â””â”€â”€ icons/
        â”œâ”€â”€ icon-192x192.png
        â””â”€â”€ icon-512x512.png
```

---

## ä»˜éŒ²

### A. å‹å®šç¾©ï¼ˆSupabaseç”Ÿæˆï¼‰

```typescript
// types/database.ts
export type Database = {
  public: {
    Tables: {
      households: {
        Row: {
          id: string
          name: string
          line_notify_token: string | null
          high_amount_threshold: number
          reset_day: number
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          name?: string
          line_notify_token?: string | null
          high_amount_threshold?: number
          reset_day?: number
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          name?: string
          line_notify_token?: string | null
          high_amount_threshold?: number
          reset_day?: number
          created_at?: string
          updated_at?: string
        }
      }
      users: {
        Row: {
          id: string
          email: string
          name: string
          nickname: string | null
          avatar_url: string | null
          household_id: string | null
          role: 'owner' | 'member'
          created_at: string
          updated_at: string
        }
        Insert: {
          id: string
          email: string
          name: string
          nickname?: string | null
          avatar_url?: string | null
          household_id?: string | null
          role?: 'owner' | 'member'
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          email?: string
          name?: string
          nickname?: string | null
          avatar_url?: string | null
          household_id?: string | null
          role?: 'owner' | 'member'
          created_at?: string
          updated_at?: string
        }
      }
      // ... ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚åŒæ§˜
    }
  }
}
```

### B. ç’°å¢ƒå¤‰æ•°ä¸€è¦§

```bash
# .env.example

# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_KEY=

# æœ¬ç•ªã®ã¿ï¼ˆVercelç’°å¢ƒå¤‰æ•°ã§è¨­å®šï¼‰
# SUPABASE_SERVICE_ROLE_KEY=
```

### C. é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# Supabaseãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•
supabase start

# Supabaseãƒ­ãƒ¼ã‚«ãƒ«åœæ­¢
supabase stop

# å‹ç”Ÿæˆ
supabase gen types typescript --local > types/database.ts

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
supabase migration new <name>

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
supabase db reset

# æœ¬ç•ªã«ãƒ—ãƒƒã‚·ãƒ¥
supabase db push

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒªãƒ³ãƒˆ
npm run lint
```

---

**è¨­è¨ˆæ›¸ çµ‚ã‚ã‚Š**
